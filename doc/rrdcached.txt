RRDCACHED(1)                        rrdtool                       RRDCACHED(1)



NNAAMMEE
       rrdcached - Data caching daemon for rrdtool

SSYYNNOOPPSSIISS
       rrrrddccaacchheedd [--ll//--LL _a_d_d_r_e_s_s] [--ww _t_i_m_e_o_u_t] [--zz _d_e_l_a_y] [--ff _t_i_m_e_o_u_t]
       [--pp _p_i_d___f_i_l_e] [--tt _w_r_i_t_e___t_h_r_e_a_d_s] [--jj _j_o_u_r_n_a_l___d_i_r] [-F] [-g]
       [--bb _b_a_s_e___d_i_r [--BB]]

DDEESSCCRRIIPPTTIIOONN
       rrrrddccaacchheedd is a daemon that receives updates to existing RRD files,
       accumulates them and, if enough have been received or a defined time
       has passed, writes the updates to the RRD file. A _f_l_u_s_h command may be
       used to force writing of values to disk, so that graphing facilities
       and similar can work with up-to-date data.

       The daemon was written with big setups in mind. Those setups usually
       run into IO related problems sooner or later for reasons that are
       beyond the scope of this document. Check the wiki at the RRDTool home-
       page for details. Also check "SECURITY CONSIDERATIONS" below before
       using this daemon! A detailed description of how the daemon operates
       can be found in the "HOW IT WORKS" section below.

OOPPTTIIOONNSS
       --ll _a_d_d_r_e_s_s
           Tells the daemon to bind to _a_d_d_r_e_s_s and accept incoming connections
           on that socket. If _a_d_d_r_e_s_s begins with "unix:", everything follow-
           ing that prefix is interpreted as the path to a UNIX domain socket.
           Otherwise the address or node name are resolved using getaddrinfo.

           For network sockets, a port may be specified by using the form
           "[address]:port". If the address is an IPv4 address or a fully
           qualified domain name (i. e. the address contains at least one dot
           (".")), the square brackets can be omitted, resulting in the (sim-
           pler) "address:port" pattern.. The default port is 4422221177//uuddpp.

           The following formats are accepted. Please note that the address of
           the UNIX domain socket mmuusstt start with a slash in the second case!

              unix:</path/to/unix.sock>
              /<path/to/unix.sock>
              <hostname-or-ip>
              [<hostname-or-ip>]:<port>
              <hostname-or-ipv4>:<port>

           If the --ll option is not specified the default address,
           "unix:/tmp/rrdcached.sock", will be used.

       --LL _a_d_d_r_e_s_s
           Same as --ll, except creates a low-privilege socket.  See SSEECCUURRIITTYY
           CCOONNSSIIDDEERRAATTIIOONNSS for more information.

       --ww _t_i_m_e_o_u_t
           Data is written to disk every _t_i_m_e_o_u_t seconds. If this option is
           not specified the default interval of 300 seconds will be used.

       --zz _d_e_l_a_y
           If specified, rrdcached will delay writing of each RRD for a random
           number of seconds in the range [0,_d_e_l_a_y).  This will avoid too many
           writes being queued simultaneously.  This value should be no
           greater than the value specified in --ww.  By default, there is no
           delay.

       --ff _t_i_m_e_o_u_t
           Every _t_i_m_e_o_u_t seconds the entire cache is searched for old values
           which are written to disk. This only concerns files to which
           updates have stopped, so setting this to a high value, such as
           3600 seconds, is acceptable in most cases. This timeout defaults to
           3600 seconds.

       --pp _f_i_l_e
           Sets the name and location of the PID-file. If not specified, the
           default, "$localststedir/run/rrdcached.pid" will be used.

       --tt _w_r_i_t_e___t_h_r_e_a_d_s
           Specifies the number of threads used for writing RRD files.  The
           default is 4.  Increasing this number will allow rrdcached to have
           more simultaneous I/O requests into the kernel.  This may allow the
           kernel to re-order disk writes, resulting in better disk through-
           put.

       --jj _d_i_r
           Write updates to a journal in _d_i_r.  In the event of a program or
           system crash, this will allow the daemon to write any updates that
           were pending at the time of the crash.

           On startup, the daemon will check for journal files in this direc-
           tory.  If found, all updates therein will be read into memory
           before the daemon starts accepting new connections.

           The journal will be rotated with the same frequency as the flush
           timer given by --ff.

           When journaling is enabled, the daemon will use a fast shutdown
           procedure.  Rather than flushing all files to disk, it will make
           sure the journal is properly written and exit immediately.
           Although the RRD data files are not fully up-to-date, no informa-
           tion is lost; all pending updates will be replayed from the journal
           next time the daemon starts up.

           To disable fast shutdown, use the --FF option.

       --FF  ALWAYS flush all updates to the RRD data files when the daemon is
           shut down, regardless of journal setting.

       --gg  Run in the foreground.  The daemon will not _f_o_r_k_(_).

       --bb _d_i_r
           The daemon will change into a specific directory at startup. All
           files passed to the daemon, that are specified by a rreellaattiivvee path,
           will be interpreted to be relative to this directory. If not given
           the default, "/tmp", will be used.

             +------------------------+------------------------+
             ! Command line           ! File updated           !
             +------------------------+------------------------+
             ! foo.rrd                ! /tmp/foo.rrd           !
             ! foo/bar.rrd            ! /tmp/foo/bar.rrd       !
             ! /var/lib/rrd/foo.rrd   ! /var/lib/rrd/foo.rrd   !
             +------------------------+------------------------+
             Paths given on the command  line and paths actually
             updated by the daemon,  assuming the base directory
             "/tmp".

           WWAARRNNIINNGG:: The paths up to and including the base directory MMUUSSTT NNOOTT
           BBEE symbolic links.  In other words, if the base directory is speci-
           fied as:

               -b /base/dir/somewhere

           ... then NNOONNEE of the following should be symbolic links:

               /base
               /base/dir
               /base/dir/somewhere

       --BB  Only permit writes into the base directory specified in --bb (and any
           sub-directories).  This does NNOOTT detect symbolic links.  Paths con-
           taining "../" will also be blocked.

AAFFFFEECCTTEEDD RRRRDDTTOOOOLL CCOOMMMMAANNDDSS
       The following commands may be made aware of the rrrrddccaacchheedd using the
       command line argument ----ddaaeemmoonn or the environment variable RRRRDD--
       CCAACCHHEEDD__AADDDDRREESSSS:

       dduummpp
       ffeettcchh
       fflluusshh
       ggrraapphh
       ggrraapphhvv
       iinnffoo
       llaasstt
       llaassttuuppddaattee
       uuppddaattee
       xxppoorrtt

       The uuppddaattee command can send values to the daemon instead of writing
       them to the disk itself. All other commands can send a FFLLUUSSHH command
       (see below) to the daemon before accessing the files, so they work with
       up-to-date data even if the cache timeout is large.

EERRRROORR RREEPPOORRTTIINNGG
       The daemon reports errors in one of two ways: During startup, error
       messages are printed to "STDERR". One of the steps when starting up is
       to fork to the background and closing "STDERR" - after this writing
       directly to the user is no longer possible. Once this has happened, the
       daemon will send log messages to the system logging daemon using _s_y_s_-
       _l_o_g(3). The facility used is "LOG_DAEMON".

HHOOWW IITT WWOORRKKSS
       When receiving an update, rrrrddccaacchheedd does not write to disk but looks
       for an entry for that file in its internal tree. If not found, an entry
       is created including the current time (called "First" in the diagram
       below). This time is nnoott the time specified on the command line but the
       time the operating system considers to be "now". The value and time of
       the value (called "Time" in the diagram below) are appended to the tree
       node.

       When appending a value to a tree node, it is checked whether it's time
       to write the values to disk. Values are written to disk if
       "now() - First >= timeout", where "timeout" is the timeout specified
       using the --ww option, see OPTIONS. If the values are "old enough" they
       will be enqueued in the "update queue", i. e. they will be appended to
       the linked list shown below.  Because the tree nodes and the elements
       of the linked list are the same data structures in memory, any update
       to a file that has already been enqueued will be written with the next
       write to the RRD file, too.

       A separate "update thread" constantly dequeues the first element in the
       update queue and writes all its values to the appropriate file. So as
       long as the update queue is not empty files are written at the highest
       possible rate.

       Since the timeout of files is checked only when new values are added to
       the file, "dead" files, i. e. files that are not updated anymore, would
       never be written to disk. Therefore, every now and then, controlled by
       the --ff option, the entire tree is walked and all "old" values are
       enqueued. Since this only affects "dead" files and walking the tree is
       relatively expensive, you should set the "flush interval" to a reason-
       ably high value. The default is 3600 seconds (one hour).

       The downside of caching values is that they won't show up in graphs
       generated from the RRD files. To get around this, the daemon provides
       the "flush command" to flush specific files. This means that the file
       is inserted at the hheeaadd of the update queue or moved there if it is
       already enqueued. The flush command will return only after the file's
       pending updates have been written to disk.

        +------+   +------+                               +------+
        ! head !   ! root !                               ! tail !
        +---+--+   +---+--+                               +---+--+
            !         /\                                      !
            !        /  \                                     !
            !       /\  /\                                    !
            !      /\/\ \ `----------------- ... --------,    !
            V     /      `-------,                       !    V
        +---+----+---+    +------+-----+             +---+----+---+
        ! File:  foo !    ! File:  bar !             ! File:  qux !
        ! First: 101 !    ! First: 119 !             ! First: 180 !
        ! Next:&bar -+--->! Next:&... -+---> ... --->! Next:NULL  !
        | Prev:NULL  !<---+-Prev:&foo  !<--- ... ----+-Prev: &... !
        +============+    +============+             +============+
        ! Time:  100 !    ! Time:  120 !             ! Time:  180 !
        ! Value:  10 !    ! Value: 0.1 !             ! Value: 2,2 !
        +------------+    +------------+             +------------+
        ! Time:  110 !    ! Time:  130 !             ! Time:  190 !
        ! Value:  26 !    ! Value: 0.1 !             ! Value: 7,3 !
        +------------+    +------------+             +------------+
        :            :    :            :             :            :
        +------------+    +------------+             +------------+
        ! Time:  230 !    ! Time:  250 !             ! Time:  310 !
        ! Value:  42 !    ! Value: 0.2 !             ! Value: 1,2 !
        +------------+    +------------+             +------------+

       The above diagram demonstrates:

          Files/values are stored in a (balanced) tree.

          Tree nodes and entries in the update queue are the same data struc-
           ture.

          The local time ("First") and the time specified in updates ("Time")
           may differ.

          Timed out values are inserted at the "tail".

          Explicitly flushed values are inserted at the "head".

          ASCII art rocks.

SSEECCUURRIITTYY CCOONNSSIIDDEERRAATTIIOONNSS
       The client/server protocol does not have any authentication or autho-
       rization mechanism.  Therefore, take care to restrict which users can
       connect to the daemon.

       Control sockets are divided into high-privilege (--ll) and low-privilege
       (--LL) sockets.  High-privilege sockets accept all commands, whereas low-
       privilege sockets accept only FFLLUUSSHH, SSTTAATTSS, and HHEELLPP.

       For a multi-user environment where only certain users require
       read/write access, the recommended configuration uses two sockets as
       follows:

       --ll _/_p_r_o_t_e_c_t_e_d_/_d_i_r_/_r_r_d_._s_o_c_k
           Create a high-privilege unix-domain socket.  This should be pro-
           tected with the same Unix permissions that are used to protect the
           RRD files.  Updates should be directed to this socket.

       --LL _1_2_7_._0_._0_._1
           Create a low-privilege TCP socket listening on localhost.  All
           users on the local system may use this to trigger FLUSH of individ-
           ual files.  Users with read-only access should be directed to this
           socket.

       If you (want to) use the network capability, i. e. let the daemon bind
       to an IPv4 or IPv6 socket, it is yyoouurr job to install a packet filter or
       similar mechanism to prevent unauthorized connections. Unless you have
       a dedicated VLAN or VPN for this, using the network option is probably
       a bad idea!

       The daemon will blindly write to any file it gets told, so you really
       should create a separate user just for this daemon. Also it does not do
       any sanity checks, so if it gets told to write values for a time far in
       the future, your files will be messed up good!

       You have been warned.

PPRROOTTOOCCOOLL
       The daemon communicates with clients using a line based ASCII protocol
       which is easy to read and easy to type. This makes it easy for scripts
       to implement the protocol and possible for users to use telnet to con-
       nect to the daemon and test stuff "by hand".

       The protocol is line based, this means that each record consists of one
       or more lines. A line is terminated by the line feed character 0x0A,
       commonly written as "\n". In the examples below, this character will be
       written as "<LF>" ("line feed").

       After the connection has been established, the client is expected to
       send a "command". A command consists of the command keyword, possibly
       some arguments, and a terminating newline character. For a list of com-
       mands, see "Valid Commands" below.

       Example:

         FLUSH /tmp/foo.rrd<LF>

       The daemon answers with a line consisting of a status code and a short
       status message, separated by one or more space characters. A negative
       status code signals an error, a positive status code or zero signal
       success. If the status code is greater than zero, it indicates the num-
       ber of lines that follow the status line.

       Examples:

        0 Success<LF>

        2 Two lines follow<LF>
        This is the first line<LF>
        And this is the second line<LF>

       VVaalliidd CCoommmmaannddss

       The following commands are understood by the daemon:

       FFLLUUSSHH _f_i_l_e_n_a_m_e
           Causes the daemon to put _f_i_l_e_n_a_m_e to the hheeaadd of the update queue
           (possibly moving it there if the node is already enqueued). The
           answer will be sent aafftteerr the node has been dequeued.

       FFLLUUSSHHAALLLL
           Causes the daemon to start flushing ALL pending values to disk.
           This returns immediately, even though the writes may take a long
           time.

       PPEENNDDIINNGG _f_i_l_e_n_a_m_e
           Shows any "pending" updates for a file, in order.  The updates
           shown have not yet been written to the underlying RRD file.

       FFOORRGGEETT _f_i_l_e_n_a_m_e
           Removes _f_i_l_e_n_a_m_e from the cache.  Any pending updates WWIILLLL BBEE LLOOSSTT.

       QQUUEEUUEE
           Shows the files that are on the output queue.  Returns zero or more
           lines in the following format, where <num_vals> is the number of
           values to be written for the <file>:

               <num_vals> <file>

       HHEELLPP [_c_o_m_m_a_n_d]
           Returns a short usage message. If no command is given, or _c_o_m_m_a_n_d
           is HHEELLPP, a list of commands supported by the daemon is returned.
           Otherwise a short description, possibly containing a pointer to a
           manual page, is returned.  Obviously, this is meant for interactive
           usage and the format in which the commands and usage summaries are
           returned is not well defined.

       SSTTAATTSS
           Returns a list of metrics which can be used to measure the daemons
           performance and check its status. For a description of the values
           returned, see "Performance Values" below.

           The format in which the values are returned is similar to many
           other line based protocols: Each value is printed on a separate
           line, each consisting of the name of the value, a colon, one or
           more spaces and the actual value.

           Example:

            9 Statistics follow
            QueueLength: 0
            UpdatesReceived: 30
            FlushesReceived: 2
            UpdatesWritten: 13
            DataSetsWritten: 390
            TreeNodesNumber: 13
            TreeDepth: 4
            JournalBytes: 190
            JournalRotate: 0

       UUPPDDAATTEE _f_i_l_e_n_a_m_e _v_a_l_u_e_s [_v_a_l_u_e_s ...]
           Adds more data to a filename. This is tthhee operation the daemon was
           designed for, so describing the mechanism again is unnecessary.
           Read "HOW IT WORKS" above for a detailed explanation.

           Note that rrdcached only accepts absolute timestamps in the update
           values.  Updates strings like "N:1:2:3" are automatically converted
           to absolute time by the RRD client library before sending to rrd-
           cached.

       WWRROOTTEE _f_i_l_e_n_a_m_e
           This command is written to the journal after a file is successfully
           written out to disk.  It is used during journal replay to determine
           which updates have already been applied.  It is _o_n_l_y valid in the
           journal; it is not accepted from the other command channels.

       BBAATTCCHH
           This command initiates the bulk load of multiple commands.  This is
           designed for installations with extremely high update rates, since
           it permits more than one command to be issued per _r_e_a_d_(_) and
           _w_r_i_t_e_(_).

           All commands are executed just as they would be if given individu-
           ally, except for output to the user.  Messages indicating success
           are suppressed, and error messages are delayed until the client is
           finished.

           Command processing is finished when the client sends a dot (".") on
           its own line.  After the client has finished, the server responds
           with an error count and the list of error messages (if any).  Each
           error messages indicates the number of the command to which it cor-
           responds, and the error message itself.  The first user command
           after BBAATTCCHH is command number one.

               client:  BATCH
               server:  0 Go ahead.  End with dot '.' on its own line.
               client:  UPDATE x.rrd 1223661439:1:2:3            <--- command #1
               client:  UPDATE y.rrd 1223661440:3:4:5            <--- command #2
               client:  and so on...
               client:  .
               server:  2 Errors
               server:  1 message for command 1
               server:  12 message for command 12

       QQUUIITT
           Disconnect from rrdcached.

       PPeerrffoorrmmaannccee VVaalluueess

       The following counters are returned by the SSTTAATTSS command:

       QQuueeuueeLLeennggtthh _(_u_n_s_i_g_n_e_d _6_4_b_i_t _i_n_t_e_g_e_r_)
           Number of nodes currently enqueued in the update queue.

       UUppddaatteessRReecceeiivveedd _(_u_n_s_i_g_n_e_d _6_4_b_i_t _i_n_t_e_g_e_r_)
           Number of UPDATE commands received.

       FFlluusshheessRReecceeiivveedd _(_u_n_s_i_g_n_e_d _6_4_b_i_t _i_n_t_e_g_e_r_)
           Number of FLUSH commands received.

       UUppddaatteessWWrriitttteenn _(_u_n_s_i_g_n_e_d _6_4_b_i_t _i_n_t_e_g_e_r_)
           Total number of updates, i. e. calls to "rrd_update_r", since the
           daemon was started.

       DDaattaaSSeettssWWrriitttteenn _(_u_n_s_i_g_n_e_d _6_4_b_i_t _i_n_t_e_g_e_r_)
           Total number of "data sets" written to disk since the daemon was
           started. A data set is one or more values passed to the UUPPDDAATTEE com-
           mand. For example: "1223661439:123:456" is one data set with two
           values. The term "data set" is used to prevent confusion whether
           individual values or groups of values are counted.

       TTrreeeeNNooddeessNNuummbbeerr _(_u_n_s_i_g_n_e_d _6_4_b_i_t _i_n_t_e_g_e_r_)
           Number of nodes in the cache.

       TTrreeeeDDeepptthh _(_u_n_s_i_g_n_e_d _6_4_b_i_t _i_n_t_e_g_e_r_)
           Depth of the tree used for fast key lookup.

       JJoouurrnnaallBByytteess _(_u_n_s_i_g_n_e_d _6_4_b_i_t _i_n_t_e_g_e_r_)
           Total number of bytes written to the journal since startup.

       JJoouurrnnaallRRoottaattee _(_u_n_s_i_g_n_e_d _6_4_b_i_t _i_n_t_e_g_e_r_)
           Number of times the journal has been rotated since startup.

SSIIGGNNAALLSS
       SIGINT and SIGTERM
           The daemon exits normally on receipt of either of these signals.
           Pending updates are handled in accordance with the --jj and --FF
           options.

       SIGUSR1
           The daemon exits AFTER flushing all updates out to disk.  This may
           take a while.

       SIGUSR2
           The daemon exits immediately, without flushing updates out to disk.
           Pending updates will be replayed from the journal when the daemon
           starts up again.  WWAARRNNIINNGG:: iiff jjoouurrnnaalliinngg ((--jj)) iiss NNOOTT eennaabblleedd,, aannyy
           ppeennddiinngg uuppddaatteess WWIILLLL BBEE LLOOSSTT.

BBUUGGSS
       No known bugs at the moment.

SSEEEE AALLSSOO
       rrdtool, rrdgraph

AAUUTTHHOORR
       rrrrddccaacchheedd and this manual page have been written by Florian Forster
       <octo at verplant.org>.

CCOONNTTRRIIBBUUTTOORRSS
       kevin brintnall <kbrint@rufus.net>



1.3.99909060808                   2009-04-09                      RRDCACHED(1)
